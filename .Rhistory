}
############################
# SUM IS FALSE --> Separate lines for each state
else if(sum==FALSE) {
if (length(states)==0 | missing(states)) {
filtered_data <- covid
}
else{
filtered_data <- covid %>%
filter(region %in% states)
}
if(value=="tot_cases"){
Value <- filtered_data$tot_cases }
else if(value=="new_cases"){
Value <- filtered_data$new_case }
else if(value=="tot_death"){
Value <- filtered_data$tot_death }
else if(value=="new_death"){
Value <- filtered_data$new_death }
else{
stop("Please print valid value (statistic) to measure.") }
if(df_print==TRUE){
returned_data <- filtered_data %>%
select(date, region, value)
print(as.data.frame(returned_data))}
plotgraph <- filtered_data %>%
group_by(region) %>%
ggplot() +
geom_line(aes(x=date, y=Value, col=region)) +
ggtitle("Occurance by State", value) + xlab("Date") + ylab("Count")
ggplotly(plotgraph)
}
}
covid_growth(states=c("california", "virginia", "new york", "arizona"), sum=T)
covid_growth(sum=T)
covid_growth(states=c("colorado", "nevada", "florida", "california"), sum=F)
covid_growth(value="tot_cases", df_print=F)
covid_growth(states=c("colorado", "nevada"), sum=T)
covid_growth(states=c("colorado", "nevada"))
covid_growth(states=c("colorado", "nevada", "florida", "california"), sum=T)
covid_growth(value="new_cases", states=c("colorado", "nevada", "florida", "california"))
?slice_max
# Create Function
county_winner <- function(Year=2016, states=c()){
require(maps)
require(dplyr)
require(ggplot2)
#load data from data folder
county_map <- read.csv("data/county_map.csv")
countypres <- read.csv("data/2 county president.csv")
county_election_years <- c(2000, 2004, 2008, 2012, 2016)
if(Year %in% county_election_years){
countypres <- na.omit(countypres)
countypres$party[countypres$party != "democrat" & countypres$party != "republican"] <- "other"
partycolor <- c("blue2", "red1", "yellow")
names(partycolor) <- unique(countypres$party)
###########
if(length(states)==0){
county_majority <- countypres %>%
filter(year==Year) %>%
group_by(region) %>%
slice_max(county_percent)     ## ISSUE IN SLICE_MAX
} else{
county_map <- county_map %>%
filter(state %in% states)
county_majority <- countypres %>%
filter(state %in% states, year==Year) %>%
group_by(region) %>%
slice_max(county_percent)
}
ggplot()+
geom_map(data=county_map, aes(map_id= region), map = county_map) +
geom_map(data=county_majority, aes(map_id= region, fill=party), map = county_map) +
expand_limits(x = county_map$long, y = county_map$lat) +
scale_fill_manual(name = "party", values = partycolor) +
coord_map("albers", lat0=30, lat1=40) +
ggtitle("County Winner Map", Year)
}
else if(Year == 2020){
stop("Data not yet available")
}
else{
stop("Must enter valid election year starting in 2000")
}
}
county_winner()
county_winner(Year = 2008)
county_winner(Year = 1996)
county_winner(Year = 2000, states=c("texas", "oklahoma"))
library(USevolve)
covid_growth()
covid_update <- function(){
require(dplyr)
require(plyr)
covid <- read.csv("https://data.cdc.gov/api/views/9mfq-cb36/rows.csv?accessType=DOWNLOAD")
# covid <- read.csv("/Users/blakenorthrop/Desktop/QAC356/USevolve/data/US Covid (to Nov8).csv")
# covid$date <- as.Date(covid$date, format="%Y-%m-%d")
# covid <- covid %>% select(-c(X.4, X.3, X.2, X.1, X))
names(covid)[names(covid) == "submission_date"] <- "date"
covid$date <- as.Date(covid$date, format="%m/%d/%Y")
names(covid)[names(covid) == "state"] <- "region"
covid$region <- revalue(covid$region, c("AL" = "alabama",
"AZ" = "arizona",
"AR"="arkansas",
"CA"="california",
"CO"="colorado",
"CT"="connecticut",
"DE"="delaware",
"FL"="florida",
"GA"="georgia",
"ID"="idaho",
"IL"="illinois",
"IN"="indiana",
"IA"="iowa",
"KS"="kansas",
"KY"="kentucky",
"LA"="louisiana",
"ME"="maine",
"MD"="maryland",
"MA"="massachusetts",
"MI"="michigan",
"MN"="minnesota",
"MS"="mississippi",
"MO"="missouri",
"MT"="montana",
"NE"="nebraska",
"NV"="nevada",
"NH"="new hampshire",
"NJ"="new jersey",
"NM"="new mexico",
"NY"="new york",
"NC"="north carolina",
"ND"="north dakota",
"OH"="ohio",
"OK"="oklahoma",
"OR"="oregon",
"PA"="pennsylvania",
"RI"="rhode island",
"SC"="south carolina",
"SD"="south dakota",
"TN"="tennessee",
"TX"="texas",
"UT"="utah",
"VT"="vermont",
"VA"="virginia",
"WA"="washington",
"WV"="west virginia",
"WI"="wisconsin",
"WY"="wyoming"))
`%notin%` <- Negate(`%in%`)
covid <- subset(covid, region %notin% c("RMI", "AS", "NYC", "PR", "DC",
"HI", "AK", "GU", "VI", "MP", "FSM", "PW"))
covid <- covid %>% select(-c(conf_cases, prob_cases, pnew_case,
conf_death, prob_death, pnew_death,
created_at, consent_cases, consent_deaths))
# Find total US cases from state sums
df <- data.frame(matrix(vector(), 0, 10,
dimnames=list(c(), c("date", "region", "tot_cases",
"new_cases", "tot_death", "new_death", "us_tot_cases",
"us_new_cases", "us_tot_death", "us_new_death"))))
for (i in 1:length(unique(covid$date))){
filtered_data <- covid %>%
filter(date==date[[i]]) %>%
mutate(us_tot_cases = sum(tot_cases),
us_new_cases = sum(new_case),
us_tot_death = sum(tot_death),
us_new_death = sum(new_death))
df <- rbind(df, filtered_data)
filtered_data <- data.frame(matrix(vector(), 0, 10))
}
covid <<- df
}
covid <- covid_update()
View(covid)
covid_update <- function(){
require(dplyr)
require(plyr)
covid <- read.csv("https://data.cdc.gov/api/views/9mfq-cb36/rows.csv?accessType=DOWNLOAD")
# covid <- read.csv("/Users/blakenorthrop/Desktop/QAC356/USevolve/data/US Covid (to Nov8).csv")
# covid$date <- as.Date(covid$date, format="%Y-%m-%d")
# covid <- covid %>% select(-c(X.4, X.3, X.2, X.1, X))
names(covid)[names(covid) == "submission_date"] <- "date"
covid$date <- as.Date(covid$date, format="%m/%d/%Y")
names(covid)[names(covid) == "state"] <- "region"
covid$region <- revalue(covid$region, c("AL" = "alabama",
"AZ" = "arizona",
"AR"="arkansas",
"CA"="california",
"CO"="colorado",
"CT"="connecticut",
"DE"="delaware",
"FL"="florida",
"GA"="georgia",
"ID"="idaho",
"IL"="illinois",
"IN"="indiana",
"IA"="iowa",
"KS"="kansas",
"KY"="kentucky",
"LA"="louisiana",
"ME"="maine",
"MD"="maryland",
"MA"="massachusetts",
"MI"="michigan",
"MN"="minnesota",
"MS"="mississippi",
"MO"="missouri",
"MT"="montana",
"NE"="nebraska",
"NV"="nevada",
"NH"="new hampshire",
"NJ"="new jersey",
"NM"="new mexico",
"NY"="new york",
"NC"="north carolina",
"ND"="north dakota",
"OH"="ohio",
"OK"="oklahoma",
"OR"="oregon",
"PA"="pennsylvania",
"RI"="rhode island",
"SC"="south carolina",
"SD"="south dakota",
"TN"="tennessee",
"TX"="texas",
"UT"="utah",
"VT"="vermont",
"VA"="virginia",
"WA"="washington",
"WV"="west virginia",
"WI"="wisconsin",
"WY"="wyoming"))
`%notin%` <- Negate(`%in%`)
covid <- subset(covid, region %notin% c("RMI", "AS", "NYC", "PR", "DC",
"HI", "AK", "GU", "VI", "MP", "FSM", "PW"))
covid <- covid %>% select(-c(conf_cases, prob_cases, pnew_case,
conf_death, prob_death, pnew_death,
created_at, consent_cases, consent_deaths))
# Find total US cases from state sums
df <- data.frame(matrix(vector(), 0, 10,
dimnames=list(c(), c("date", "region", "tot_cases",
"new_cases", "tot_death", "new_death", "us_tot_cases",
"us_new_cases", "us_tot_death", "us_new_death"))))
for (i in 1:length(unique(covid$date))){
filtered_data <- covid %>%
filter(date==date[[i]]) %>%
mutate(us_tot_cases = sum(tot_cases),
us_new_cases = sum(new_case),
us_tot_death = sum(tot_death),
us_new_death = sum(new_death))
df <- rbind(df, filtered_data)
filtered_data <- data.frame(matrix(vector(), 0, 10))
}
covid <- df
}
covid_update()
covid_update <- function(){
require(dplyr)
require(plyr)
covid <- read.csv("https://data.cdc.gov/api/views/9mfq-cb36/rows.csv?accessType=DOWNLOAD")
# covid <- read.csv("/Users/blakenorthrop/Desktop/QAC356/USevolve/data/US Covid (to Nov8).csv")
# covid$date <- as.Date(covid$date, format="%Y-%m-%d")
# covid <- covid %>% select(-c(X.4, X.3, X.2, X.1, X))
names(covid)[names(covid) == "submission_date"] <- "date"
covid$date <- as.Date(covid$date, format="%m/%d/%Y")
names(covid)[names(covid) == "state"] <- "region"
covid$region <- revalue(covid$region, c("AL" = "alabama",
"AZ" = "arizona",
"AR"="arkansas",
"CA"="california",
"CO"="colorado",
"CT"="connecticut",
"DE"="delaware",
"FL"="florida",
"GA"="georgia",
"ID"="idaho",
"IL"="illinois",
"IN"="indiana",
"IA"="iowa",
"KS"="kansas",
"KY"="kentucky",
"LA"="louisiana",
"ME"="maine",
"MD"="maryland",
"MA"="massachusetts",
"MI"="michigan",
"MN"="minnesota",
"MS"="mississippi",
"MO"="missouri",
"MT"="montana",
"NE"="nebraska",
"NV"="nevada",
"NH"="new hampshire",
"NJ"="new jersey",
"NM"="new mexico",
"NY"="new york",
"NC"="north carolina",
"ND"="north dakota",
"OH"="ohio",
"OK"="oklahoma",
"OR"="oregon",
"PA"="pennsylvania",
"RI"="rhode island",
"SC"="south carolina",
"SD"="south dakota",
"TN"="tennessee",
"TX"="texas",
"UT"="utah",
"VT"="vermont",
"VA"="virginia",
"WA"="washington",
"WV"="west virginia",
"WI"="wisconsin",
"WY"="wyoming"))
`%notin%` <- Negate(`%in%`)
covid <- subset(covid, region %notin% c("RMI", "AS", "NYC", "PR", "DC",
"HI", "AK", "GU", "VI", "MP", "FSM", "PW"))
covid <- covid %>% select(-c(conf_cases, prob_cases, pnew_case,
conf_death, prob_death, pnew_death,
created_at, consent_cases, consent_deaths))
# Find total US cases from state sums
df <- data.frame(matrix(vector(), 0, 10,
dimnames=list(c(), c("date", "region", "tot_cases",
"new_cases", "tot_death", "new_death", "us_tot_cases",
"us_new_cases", "us_tot_death", "us_new_death"))))
for (i in 1:length(unique(covid$date))){
filtered_data <- covid %>%
filter(date==date[[i]]) %>%
mutate(us_tot_cases = sum(tot_cases),
us_new_cases = sum(new_case),
us_tot_death = sum(tot_death),
us_new_death = sum(new_death))
df <- rbind(df, filtered_data)
filtered_data <- data.frame(matrix(vector(), 0, 10))
}
covid <- df
}
covid_update()
covid_update <- function(){
require(dplyr)
require(plyr)
covid <- read.csv("https://data.cdc.gov/api/views/9mfq-cb36/rows.csv?accessType=DOWNLOAD")
# covid <- read.csv("/Users/blakenorthrop/Desktop/QAC356/USevolve/data/US Covid (to Nov8).csv")
# covid$date <- as.Date(covid$date, format="%Y-%m-%d")
# covid <- covid %>% select(-c(X.4, X.3, X.2, X.1, X))
names(covid)[names(covid) == "submission_date"] <- "date"
covid$date <- as.Date(covid$date, format="%m/%d/%Y")
names(covid)[names(covid) == "state"] <- "region"
covid$region <- revalue(covid$region, c("AL" = "alabama",
"AZ" = "arizona",
"AR"="arkansas",
"CA"="california",
"CO"="colorado",
"CT"="connecticut",
"DE"="delaware",
"FL"="florida",
"GA"="georgia",
"ID"="idaho",
"IL"="illinois",
"IN"="indiana",
"IA"="iowa",
"KS"="kansas",
"KY"="kentucky",
"LA"="louisiana",
"ME"="maine",
"MD"="maryland",
"MA"="massachusetts",
"MI"="michigan",
"MN"="minnesota",
"MS"="mississippi",
"MO"="missouri",
"MT"="montana",
"NE"="nebraska",
"NV"="nevada",
"NH"="new hampshire",
"NJ"="new jersey",
"NM"="new mexico",
"NY"="new york",
"NC"="north carolina",
"ND"="north dakota",
"OH"="ohio",
"OK"="oklahoma",
"OR"="oregon",
"PA"="pennsylvania",
"RI"="rhode island",
"SC"="south carolina",
"SD"="south dakota",
"TN"="tennessee",
"TX"="texas",
"UT"="utah",
"VT"="vermont",
"VA"="virginia",
"WA"="washington",
"WV"="west virginia",
"WI"="wisconsin",
"WY"="wyoming"))
`%notin%` <- Negate(`%in%`)
covid <- subset(covid, region %notin% c("RMI", "AS", "NYC", "PR", "DC",
"HI", "AK", "GU", "VI", "MP", "FSM", "PW"))
covid <- covid %>% select(-c(conf_cases, prob_cases, pnew_case,
conf_death, prob_death, pnew_death,
created_at, consent_cases, consent_deaths))
# Find total US cases from state sums
df <- data.frame(matrix(vector(), 0, 10,
dimnames=list(c(), c("date", "region", "tot_cases",
"new_cases", "tot_death", "new_death", "us_tot_cases",
"us_new_cases", "us_tot_death", "us_new_death"))))
for (i in 1:length(unique(covid$date))){
filtered_data <- covid %>%
filter(date==date[[i]]) %>%
mutate(us_tot_cases = sum(tot_cases),
us_new_cases = sum(new_case),
us_tot_death = sum(tot_death),
us_new_death = sum(new_death))
df <- rbind(df, filtered_data)
filtered_data <- data.frame(matrix(vector(), 0, 10))
}
covid <<- df
}
covid_update()
#load latest covid data
covid <- USevolve:::covid_update()
#load latest covid data
USevolve:::covid_update()
#load latest covid data
covid2 <- USevolve:::covid_update()
#load latest covid data
covid <<- USevolve:::covid_update()
covid_update <- function(){
require(dplyr)
require(plyr)
covid <- read.csv("https://data.cdc.gov/api/views/9mfq-cb36/rows.csv?accessType=DOWNLOAD")
# covid <- read.csv("/Users/blakenorthrop/Desktop/QAC356/USevolve/data/US Covid (to Nov8).csv")
# covid$date <- as.Date(covid$date, format="%Y-%m-%d")
# covid <- covid %>% select(-c(X.4, X.3, X.2, X.1, X))
names(covid)[names(covid) == "submission_date"] <- "date"
covid$date <- as.Date(covid$date, format="%m/%d/%Y")
names(covid)[names(covid) == "state"] <- "region"
covid$region <- revalue(covid$region, c("AL" = "alabama",
"AZ" = "arizona",
"AR"="arkansas",
"CA"="california",
"CO"="colorado",
"CT"="connecticut",
"DE"="delaware",
"FL"="florida",
"GA"="georgia",
"ID"="idaho",
"IL"="illinois",
"IN"="indiana",
"IA"="iowa",
"KS"="kansas",
"KY"="kentucky",
"LA"="louisiana",
"ME"="maine",
"MD"="maryland",
"MA"="massachusetts",
"MI"="michigan",
"MN"="minnesota",
"MS"="mississippi",
"MO"="missouri",
"MT"="montana",
"NE"="nebraska",
"NV"="nevada",
"NH"="new hampshire",
"NJ"="new jersey",
"NM"="new mexico",
"NY"="new york",
"NC"="north carolina",
"ND"="north dakota",
"OH"="ohio",
"OK"="oklahoma",
"OR"="oregon",
"PA"="pennsylvania",
"RI"="rhode island",
"SC"="south carolina",
"SD"="south dakota",
"TN"="tennessee",
"TX"="texas",
"UT"="utah",
"VT"="vermont",
"VA"="virginia",
"WA"="washington",
"WV"="west virginia",
"WI"="wisconsin",
"WY"="wyoming"))
`%notin%` <- Negate(`%in%`)
covid <- subset(covid, region %notin% c("RMI", "AS", "NYC", "PR", "DC",
"HI", "AK", "GU", "VI", "MP", "FSM", "PW"))
covid <- covid %>% select(-c(conf_cases, prob_cases, pnew_case,
conf_death, prob_death, pnew_death,
created_at, consent_cases, consent_deaths))
# Find total US cases from state sums
df <- data.frame(matrix(vector(), 0, 10,
dimnames=list(c(), c("date", "region", "tot_cases",
"new_cases", "tot_death", "new_death", "us_tot_cases",
"us_new_cases", "us_tot_death", "us_new_death"))))
for (i in 1:length(unique(covid$date))){
filtered_data <- covid %>%
filter(date==date[[i]]) %>%
mutate(us_tot_cases = sum(tot_cases),
us_new_cases = sum(new_case),
us_tot_death = sum(tot_death),
us_new_death = sum(new_death))
df <- rbind(df, filtered_data)
filtered_data <- data.frame(matrix(vector(), 0, 10))
}
covid <- df
}
library(USevolve)
covid_growth()
covid_growth(sum=T)
